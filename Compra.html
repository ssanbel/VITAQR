<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finalizar Compra</title>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #fafafa;
      display: flex;
      justify-content: center;
    }

    .container {
      display: flex;
      max-width: 1200px;
      width: 100%;
      gap: 40px;
    }

    .formulario {
      flex: 2;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    .formulario h2 {
      margin-bottom: 20px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }

    .formulario form {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .formulario form input,
    .formulario form select {
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
    }

    #Departamento {
      width: 103.5%;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      width: 10%;
      cursor: pointer;
    }

    .checkbox-label span {
      flex: 1;
      cursor: pointer;
      white-space: nowrap;
    }

    .checkbox-contenedor {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      width: 10%;
      cursor: pointer;
    }

    .checkbox-contenedor span {
      flex: 1;
      color: blue;
      text-decoration: underline;
      cursor: pointer;
      white-space: nowrap;
    }

    .formulario button {
      padding: 12px;
      background-color: #1e88e5;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .resumen {
      flex: 1;
      background: #f8f8f8;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    .resumen h2 {
      margin-bottom: 15px;
      font-size: 20px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }

    .producto {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }

    .producto img {
      max-width: 80px;
      margin-bottom: 10px;
    }

    .total {
      font-weight: bold;
      font-size: 18px;
      margin-top: 20px;
      text-align: right;
    }

    select:invalid {
      color: gray;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.6);
    }

    .modal-contenido {
      background-color: white;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 500px;
      position: relative;
      text-align: center;
    }

    .cerrar {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
    }

    .opciones-pago button {
      background-color: #2c1d59;
      color: white;
      border: none;
      padding: 14px 20px;
      font-size: 16px;
      border-radius: 8px;
      margin: 10px 0;
      cursor: pointer;
      width: 100%;
    }

    .modal-contenido button {
      background-color: #2c1d59;
      color: white;
      border: none;
      padding: 14px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      width: 100%;
    }

    .modal-contenido h2 {
      font-size: 20px !important;
      margin-bottom: 15px;
    }

    .modal-contenido input {
      font-size: 16px;
      padding: 12px;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 12px;
    }

    .opciones-pago button {
      font-size: 16px;
      padding: 12px;
      width: 100%;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .modal-contenido .cerrar {
      font-size: 26px;
      top: 8px;
      right: 12px;
    }

    .modal-contenido img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      margin-top: 10px;
    }

  @media screen and (max-width: 768px) {
   body {
    margin: 10px;
    padding: 0;
  }

  .resumen {
    width: 100%;
    max-width: 340px;
    margin: 0 auto;
    box-sizing: border-box;
  }

  .container {
    flex-direction: column;
    align-items: center;
    gap: 20px;
    padding: 0 10px;
  }

  .formulario {
    width: 100%;
    max-width: 340px;
    margin: 0 auto;
    padding: 20px 15px;
    box-sizing: border-box;
  }

  .formulario form input,
  .formulario form select,
  .formulario button {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box;
    font-size: 15px;
  }

  .checkbox-label {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    width: 100%;
    font-size: 14px;
    flex-wrap: wrap;
    word-break: normal;
  }

  .checkbox-label input {
    margin-top: 3px;
  }

  .checkbox-contenedor {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    width: 100%;
    font-size: 14px;
    flex-wrap: wrap;
  }

  .checkbox-contenedor input {
    margin-top: 3px;
  }

  .checkbox-contenedor span {
    flex: 1;
    white-space: normal;
    word-break: break-word;
    text-align: left;
  }

  .checkbox-label span {
    flex: 1;
    white-space: normal;
    word-break: break-word;
    text-align: left;
  }

  .producto img {
    width: 50%;
    max-width: 50%;
    height: auto;
  }

  .modal-contenido {
    width: 95%;
    margin-top: 30%;
    padding: 20px;
  }
  }

  </style>
</head>
<body>
  <div class="container">
    <div class="formulario">
      <h2>Informaci√≥n de contacto</h2>
      <form>
        <input type="email" placeholder="Correo electr√≥nico">
        <label class="checkbox-label">
          <input type="checkbox">
          <span>Enviarme novedades y ofertas por correo electr√≥nico</span>
        </label>

        <h2>Datos de env√≠o</h2>
        <input type="text" placeholder="Nombre" pattern="[A-Za-z√Å√â√ç√ì√ö√ë√°√©√≠√≥√∫√±\s]+" title="Solo letras y espacios" required>
        <input type="text" placeholder="Apellidos" pattern="[A-Za-z√Å√â√ç√ì√ö√ë√°√©√≠√≥√∫√±\s]+" title="Solo letras y espacios" required>
        <input type="text" placeholder="DNI" pattern="\d{8}" maxlength="8" title="Debe tener 8 d√≠gitos num√©ricos" required>
        <input type="text" placeholder="N√∫mero celular" pattern="\d{9}" maxlength="9" title="Debe tener 9 d√≠gitos num√©ricos" required>
        <input type="text" placeholder="Provincia" pattern="[A-Za-z√Å√â√ç√ì√ö√ë√°√©√≠√≥√∫√±\s]+" title="Solo letras y espacios" required>
        <input type="text" placeholder="Distrito" pattern="[A-Za-z√Å√â√ç√ì√ö√ë√°√©√≠√≥√∫√±\s]+" title="Solo letras y espacios" required>
        <input type="text" placeholder="Direcci√≥n" required>
        <input type="number" placeholder="C√≥digo postal (opcional)">
        <div class="checkbox-contenedor">
          <input type="checkbox" id="terminosCheckbox" required>
            <span id="abrirModal">
              Aceptar t√©rminos y condiciones
            </span>
        </div>

        <button onclick="abrirModalPago(event)">Finalizar pedido</button>
        <button onclick="window.location.href='/carrito'">Volver</button>
      </form>
    </div>

    <div class="resumen">
      <h2>Resumen del pedido</h2>
      <div id="resumen-productos"></div>
      <p class="subtotal" id="subtotal-general">Subtotal: S/ 0.00</p>
      <p class="envio" id="envio">Env√≠o: S/ 0.00</p>
      <p class="total" id="total-general">Total: S/ 0.00</p>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalTerminos" class="modal">
    <div class="modal-contenido">
      <span class="cerrar" id="cerrarModal">&times;</span>
      <h2>T√©rminos y condiciones</h2>
      <p>
        Estos son los t√©rminos y condiciones de la tienda. <br>
        Aqu√≠ se debe incluir toda la informaci√≥n legal, pol√≠tica de privacidad, devoluciones, etc. GA
      </p>
      <button id="btnAceptarModal">Aceptar</button>
    </div>
  </div>

    <!-- MODAL: Elegir m√©todo de pago -->
  <div id="modalPago" class="modal">
    <div class="modal-contenido">
      <span class="cerrar" onclick="cerrarModales()">&times;</span>
      <h2>¬øC√≥mo deseas pagar?</h2>
      <div class="opciones-pago">
        <button onclick="abrirTarjeta()">üí≥ Tarjeta de cr√©dito/d√©bito</button>
        <button onclick="abrirYape()">üì± Yape / Plin</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Pago con tarjeta -->
  <div id="modalTarjeta" class="modal">
    <div class="modal-contenido">
      <span class="cerrar" onclick="cerrarModales()">&times;</span>
      <h2>Completa tus datos</h2>
      <input type="text" placeholder="Titular de la tarjeta" required>
      <input type="text" placeholder="N√∫mero de tarjeta" maxlength="16" required>
      <input type="text" placeholder="Expira: MM/AA" required>
      <input type="text" placeholder="CVV" maxlength="4" required>
      <input type="text" placeholder="DNI" required>
      <input type="tel" placeholder="Tel√©fono" required>
      <button onclick="finalizarPago()">Pagar</button>
    </div>
  </div>

  <!-- MODAL: Pago con Yape -->
  <div id="modalYape" class="modal">
    <div class="modal-contenido" style="text-align:center;">
      <span class="cerrar" onclick="cerrarModales()">&times;</span>
      <h2>Escanea para pagar</h2>
      <img src="/static/img/yape.jpg" alt="QR Yape" style="width:80%;max-width:300px;border-radius:10px;">
      <button onclick="finalizarPago()">He pagado</button>
    </div>
  </div>

  <script>
    // Modal
    const modal = document.getElementById("modalTerminos");
    const abrir = document.getElementById("abrirModal");
    const cerrar = document.getElementById("cerrarModal");
    const btnAceptarModal = document.getElementById("btnAceptarModal");

    abrir.addEventListener("click", () => {
      modal.style.display = "block";
    });

    cerrar.addEventListener("click", () => {
      modal.style.display = "none";
    });

    btnAceptarModal.addEventListener("click", () => {
      modal.style.display = "none";
    });

    window.addEventListener("click", (e) => {
      if (e.target == modal) {
        modal.style.display = "none";
      }
    });

    // Carrito
    const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    const contenedorResumen = document.getElementById("resumen-productos");
    const totalGeneralEl = document.getElementById("total-general");

    function renderizarResumen() {
      let totalGeneral = 0;
      let subtotal = 0;
      const envioFijo = 10.00;
      contenedorResumen.innerHTML = "";

      if (carrito.length === 0) {
        contenedorResumen.innerHTML = "<p>No hay productos en el carrito.</p>";
        document.getElementById("subtotal-general").textContent = `Subtotal: S/ 0.00`;
        document.getElementById("envio").textContent = `Env√≠o: S/ 0.00`;
        document.getElementById("total-general").textContent = `Total: S/ 0.00`;
        return;
      }

      carrito.forEach(producto => {
        const sub = producto.precio * producto.cantidad;
        subtotal += sub;
        total = sub;

        contenedorResumen.innerHTML += `
          <div class="producto">
            <img src="${producto.imagen}" alt="${producto.nombre}">
            <p><strong>Producto:</strong> ${producto.nombre}</p>
            <p><strong>Precio unitario:</strong> S/ ${producto.precio.toFixed(2)}</p>
            <p><strong>Cantidad:</strong> ${producto.cantidad}</p>
            <p><strong>Subtotal:</strong> S/ ${total.toFixed(2)}</p>
          </div>`;
        
      });

      const envio = subtotal > 0 ? envioFijo : 0;
      totalGeneral = subtotal + envio;
      document.getElementById("subtotal-general").textContent = `Subtotal: S/ ${subtotal.toFixed(2)}`;
      document.getElementById("envio").textContent = `Env√≠o: S/ ${envio.toFixed(2)}`;
      document.getElementById("total-general").textContent = `Total: S/ ${totalGeneral.toFixed(2)}`;
    }

    renderizarResumen();

  function validarFormulario() {
    const campos = document.querySelectorAll('.formulario form input[required]');
    const terminos = document.getElementById('terminosCheckbox');
    for (let input of campos) {
      if (!input.value.trim()) {
        alert("Por favor, completa todos los campos obligatorios.");
        return false;
      }
    }
    if (!terminos.checked) {
      alert("Debes aceptar los t√©rminos y condiciones.");
      return false;
    }
    return true;
  }

  document.querySelector('.formulario form').addEventListener('submit', function(e) {
    e.preventDefault();
    if (validarFormulario()) {
      document.getElementById('modalPago').style.display = 'block';
    }
  });

  function abrirTarjeta() {
    document.getElementById('modalPago').style.display = 'none';
    document.getElementById('modalTarjeta').style.display = 'block';
  }

  function abrirYape() {
    document.getElementById('modalPago').style.display = 'none';
    document.getElementById('modalYape').style.display = 'block';
  }

  function cerrarModales() {
    document.getElementById('modalPago').style.display = 'none';
    document.getElementById('modalTarjeta').style.display = 'none';
    document.getElementById('modalYape').style.display = 'none';
  }

  function finalizarPago() {
    cerrarModales();
    alert("¬°Pago procesado correctamente!");
    window.location.href = "/";
  }
  </script>
</body>
</html>
